import{_ as fe,r as h,q as Q,I as Z,J as ee,u as te,K as i,N as se,P as _e,F as be,X as ie,R as xe,S as Me,W as Fe}from"./_plugin-vue_export-helper-BZwHZS2b.js";const ne=L=>(xe("data-v-dea953c4"),L=L(),Me(),L),Ee=ne(()=>i("div",{class:"wrap"},null,-1)),Ye={key:0,id:"start-wrap"},Se={id:"awesome_screenshot_size",style:{"min-width":"70px",display:"block"}},ke={id:"screenshot_annotate",class:"annotate_toolbar",style:{display:"none"}},He=ie('<input id="file_input" type="file" class="file-input" accept=".jpg,.png,.jpeg" data-v-dea953c4><div id="shapes_area" class="shapes_area" style="display:none;" data-v-dea953c4><div id="awesome_rect_btn" class="toolbar_item tooltip tooltip-right" aria-label="矩形框" data-v-dea953c4><div class="toolbtn rect" data-v-dea953c4></div></div><div id="awesome_round_btn" class="toolbar_item tooltip tooltip-right" aria-label="椭圆" data-v-dea953c4><div class="toolbtn ellipse" data-v-dea953c4></div></div><div id="awesome_arrow_btn" class="toolbar_item tooltip tooltip-right" aria-label="箭头" data-v-dea953c4><div class="toolbtn line_arrow" data-v-dea953c4></div></div><div id="awesome_freeline_btn" class="toolbar_item tooltip tooltip-right" aria-label="笔" data-v-dea953c4><div class="toolbtn curve" data-v-dea953c4></div></div><div id="awesome_blur_btn" class="toolbar_item tooltip tooltip-right" aria-label="模糊" data-v-dea953c4><div class="toolbtn rect_blur" data-v-dea953c4></div></div><div id="awesome_undo_btn" aria-label="撤销" class="toolbar_item action_item tooltip tooltip-right disable" data-v-dea953c4><div class="toolbtn undobtn" data-v-dea953c4></div></div><div id="awesome_text_btn" class="toolbar_item tooltip tooltip-right" aria-label="文字" data-v-dea953c4><div class="toolbtn text" data-v-dea953c4></div></div><div id="awesome_callout_btn" class="toolbar_item tooltip tooltip-right premium isfree" aria-label="标注" data-v-dea953c4><div class="toolbtn callout" data-v-dea953c4></div></div><div id="awesome_step_btn" class="toolbar_item tooltip tooltip-right premium isfree" aria-label="步骤" data-v-dea953c4><div class="toolbtn list" data-v-dea953c4></div></div><div id="awesome_image_btn" class="toolbar_item tooltip tooltip-right premium isfree" aria-label="表情" data-v-dea953c4><div class="toolbtn image" data-v-dea953c4></div></div><div id="awesome_image_local_btn" class="toolbar_item tooltip tooltip-right premium isfree" aria-label="图片" data-v-dea953c4><div class="toolbtn insertImage" data-v-dea953c4></div></div><div class="sep_line" data-v-dea953c4></div><div id="awesome_clear_btn" class="toolbar_item action_item tooltip tooltip-right disable" aria-label="清除" data-v-dea953c4><div class="toolbtn clear-all icon-text" data-v-dea953c4></div></div></div>',2),Ie={class:"action_area"},Xe={t:"1695195852681",class:"icon",style:{width:"17px",height:"17px"},viewBox:"0 0 1025 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1469",width:"200",height:"200"},Ce=ne(()=>i("path",{d:"M513.024 1024C230.254592 1024 1.024 794.769408 1.024 512S230.254592 0 513.024 0s512 229.230592 512 512-229.230592 512-512 512z m0-589.579264l-168.0896-168.0896-77.579264 77.579264L435.444736 512l-168.0896 168.0896 77.579264 77.579264L513.024 589.579264l168.0896 168.0896 77.579264-77.579264L590.603264 512l168.0896-168.0896-77.579264-77.579264L513.024 434.420736z",fill:"#cdcdcd","p-id":"1470"},null,-1)),De=[Ce],Le=ie('<div id="awesome_color_panel" class="color_panel left" data-v-dea953c4><div class="trangle" data-v-dea953c4></div><div class="colors" data-v-dea953c4><div id="awesome_width_small" class="width_cell shape" data-v-dea953c4><div class="dot small" data-v-dea953c4></div><div class="font small" data-v-dea953c4>A</div></div><div id="awesome_width_middle" class="width_cell shape" data-v-dea953c4><div class="dot middle" data-v-dea953c4></div><div class="font middle" data-v-dea953c4>A</div></div><div id="awesome_width_big" class="width_cell shape" data-v-dea953c4><div class="dot big" data-v-dea953c4></div><div class="font big" data-v-dea953c4>A</div></div><div id="red_clr" class="color_cell red" data-v-dea953c4></div><div id="blue_clr" class="color_cell blue" data-v-dea953c4></div><div id="green_clr" class="color_cell green" data-v-dea953c4></div><div id="yellow_clr" class="color_cell yellow" data-v-dea953c4></div><div id="gray_clr" class="color_cell gray" data-v-dea953c4></div><div id="white_clr" class="color_cell white" data-v-dea953c4></div></div></div><div id="awesome_svgs_panel" class="svg-panel right" data-v-dea953c4></div>',2),ze={__name:"index",setup(L){let A=h(0),de=h(0),K=h(!1),g=h(null),z=h(null),Y=h(null),B=h(null),W=h(null),o=h(null),V=h(0),q=h(0),y=[],b="";const O=h(!1);document.addEventListener("keydown",function(e){e.ctrlKey&&e.shiftKey&&e.keyCode===83&&(e.preventDefault(),U()),e.ctrlKey&&e.shiftKey&&e.keyCode===77&&(e.preventDefault(),U())}),Q(()=>{console.log("开始安装接受端口"),console.log(chrome),chrome!=null&&chrome.runtime&&chrome.runtime.onMessage.addListener(async e=>{console.log("message",e),e.type=="screenshot"?(O.value=e.new_tab,console.log("执行截图"),U()):e.type=="base64"&&y.push(e.data)}),console.log("信息接收端准备完毕")});let S=!1,T=!1,k=0,H=0,I,x,M,$,N,F,P,n,m=window.scrollY;const re=e=>{console.log("执行了"),T=!1,I=!0,H=e.clientX,k=e.clientY},ce=e=>{if(S){if(I){if(console.log("走到这里了"),(n=="tl"||n=="tm"||n=="tr")&&!E){let l=e.clientY-P;l>0?(o.value.style.height=M-Math.abs(l)+"px",o.value.style.top=$+Math.abs(l)+"px"):(o.value.style.height=M+Math.abs(l)+"px",o.value.style.top=$-Math.abs(l)+"px")}if(n=="tl"||n=="ml"||n=="bl"){let l=e.clientX-F;l>0?(o.value.style.width=x-Math.abs(l)+"px",o.value.style.left=N+Math.abs(l)+"px"):(o.value.style.width=x+Math.abs(l)+"px",o.value.style.left=N-Math.abs(l)+"px")}if((n=="bl"||n=="bm"||n=="br")&&!E){let l=e.clientY-P;l>0?o.value.style.height=M+Math.abs(l)+"px":o.value.style.height=M-Math.abs(l)+"px"}if(n=="tr"||n=="br"||n=="mr"){let l=e.clientX-F;l>0?o.value.style.width=x+Math.abs(l)+"px":o.value.style.width=x-Math.abs(l)+"px"}}D();return}if(I){var t=window.scrollY||window.pageYOffset;g.value.style.backgroundColor="rgba(0, 0, 0, 0)",T=!0,Q(()=>{if(e.clientX-H<0)o.value.style.width=Math.abs(e.clientX-H)+"px",o.value.style.left=Math.abs(e.clientX)+"px";else{o.value.style.width=e.clientX-H+"px";let l=o.value.style.width;o.value.style.left=e.clientX-parseFloat(l)+"px"}if(e.clientY-k<0)o.value.style.height=Math.abs(e.clientY-k)+"px",o.value.style.top=Math.abs(e.clientY)+t+"px";else{o.value.style.height=e.clientY-k+"px";let l=o.value.style.height;o.value.style.top=e.clientY-parseFloat(l)+t+"px"}D()})}},ue=e=>{if(I=!1,n="",!S)if(T)S=!0;else{S=!0,console.log("执行了"),o.value.style.width="200px",o.value.style.height="200px";let t=o.value.style.width,l=o.value.style.height;o.value.style.left=Math.max(e.clientX-parseFloat(t)/2,0)+"px",o.value.style.top=Math.max(e.clientY-parseFloat(l)/2,0)+"px",D(),g.value.style.backgroundColor="rgba(0, 0, 0, 0)"}};let X=!1,C,R,E=null;const U=()=>{K.value=!0,y=[],b="",Q(()=>{g&&(console.log("执行了"),console.log(g.value),g.value.style.backgroundColor="rgba(0, 0, 0, 0.3)");const e=document.documentElement.scrollHeight,t=document.documentElement.scrollWidth;A.value=t,de.value=e,g.value.style.height=e+"px",g.value.style.width=t+"px"}),window.keydownFun=function(e){e.keyCode===27&&(console.log("ESC键被按下"),J())},document.addEventListener("keydown",window.keydownFun),window.windowmoverFun=function(e){window.mouseY=e.clientY,window.mouseX=e.clientX},document.addEventListener("mousemove",window.windowmoverFun),window.windowScrollFun=function(){const e=window.scrollY;if(X&&!n){if(e>m){const t=e-m;console.log(`向下滚动了 ${t}px`),o.value.style.top=parseFloat(o.value.style.top)+t+"px"}else if(e<m){const t=m-e;console.log(`向上滚动了 ${t}px`),o.value.style.top=parseFloat(o.value.style.top)-t+"px"}}if(n){if(E=1,e>m){const t=e-m;console.log(`dir向下滚动了 ${t}px`),o.value.style.height=window.mouseY+window.scrollY-parseFloat(o.value.style.top)+"px"}else if(e<m){const t=m-e;o.value.style.height=window.mouseY+window.scrollY-parseFloat(o.value.style.top)+"px",console.log(`dir向上滚动了 ${t}px`)}}(n||X)&&(m=e,D())},window.addEventListener("scroll",window.windowScrollFun),window.mouseupFun=function(){E=null},window.addEventListener("mouseup",window.mouseupFun)},ve=e=>{n||(C=e.layerX,R=e.layerY,X=!0)},we=e=>{X=!1},pe=e=>{if(E||n||!X)return;let t=e.clientX,l=e.clientY;var s=window.scrollY||window.pageYOffset;if(console.log(s,"scrotop"),window.innerWidth<=t-C+parseFloat(o.value.style.width))o.value.style.left=window.innerWidth-parseFloat(o.value.style.width)+"px";else{if(console.log(Math.max(t-C,0)+parseFloat(o.value.style.width),A.value),Math.max(t-C,0)+parseFloat(o.value.style.width)>=A.value)return;o.value.style.left=Math.max(t-C,0)+"px"}if(l-R+s+parseFloat(o.value.style.height)+3>=document.documentElement.scrollHeight){console.log("触底还往下");return}else{if(console.log("上下拖拽"),l-R+s<0)return;o.value.style.top=l-R+s+"px"}console.log("拖动center事件"),D()},D=(e,t,l,s)=>{let u=o.value.offsetTop,a=o.value.offsetLeft,d=parseFloat(o.value.style.height),v=parseFloat(o.value.style.width);q.value=d,V.value=v,z.value.style.height=u+"px",z.value.style.top="0px",z.value.style.width=a+v+"px",Y.value.style.height=document.documentElement.scrollHeight-u-d+"px",Y.value.style.top=u+d+"px",Y.value.style.width=document.documentElement.clientWidth-a+"px",Y.value.style.left=a+"px",B.value.style.height=document.documentElement.scrollHeight-u+"px",B.value.style.width=a+"px",B.value.style.top=u+"px",W.value.style.height=u+d+"px",W.value.style.width=Math.max(0,document.documentElement.clientWidth-a-v)+"px",W.value.style.left=a+v+"px";let r=document.querySelector("#screenshot_annotate");r.style.display="block",window.innerWidth-160<a+v?a<140?r.style.left=a+v-140+"px":r.style.left=a-140+"px":r.style.left=a+v+10+"px",r.style.top=u+d-100+"px";let w=document.querySelector("#awesome_screenshot_size");parseFloat(o.value.style.top)>50?w.style.top="-30px":w.style.top="0px"},f=(e,t)=>{n=e,x=parseFloat(o.value.style.width),M=parseFloat(o.value.style.height),$=parseFloat(o.value.style.top),N=parseFloat(o.value.style.left),F=t.clientX,P=t.clientY,console.log(F),console.log(F)};function oe(e){for(var t=document.getElementsByTagName("*"),l=0;l<t.length;l++){var s=t[l],u=window.getComputedStyle(s);u.position==="fixed"&&(e==="hide"?s.style.opacity="0":e==="show"&&(s.style.opacity="1"))}}const he=async()=>{let e=parseFloat(o.value.style.left),t=parseFloat(o.value.style.top),l=parseFloat(o.value.style.width),s=parseFloat(o.value.style.height);await ye(),window.isTopStartScreen!==1&&(t=t-(window.isTopStartScreen-1)*window.innerHeight),console.log("left:"+e,"top:",+t,"width:"+l+"height:"+s);let u=await me(e,t,l,s);try{console.log(O.value,"new_tab.value???"),O.value?chrome.runtime.sendMessage({msg:"new_tab_search_img",base64:u}):chrome.runtime.sendMessage({type:"screenshot_base64",base64:u})}catch(a){console.log(a,"e")}J()},J=()=>{g.value.style.backgroundColor="rgba(0, 0, 0, 0)",K.value=!1,S=!1,T=!1,k=0,H=0,I=!1,x=0,M=0,$=0,N=0,F=0,P=0,n=null,V.value=0,q.value=0,E=null,m=window.scrollY,window.removeEventListener("scroll",window.windowScrollFun),window.removeEventListener("mousemove",window.windowmoverFun),window.removeEventListener("keydown",window.keydownFun),window.removeEventListener("mouseup",window.mouseupFun),b="",y=[]},me=async(e,t,l,s)=>new Promise((u,a)=>{var d=document.createElement("canvas"),v=d.getContext("2d"),r=window.devicePixelRatio||1,w=new Image;w.src=b,window.base64Result=b,w.onload=function(){d.width=l,d.height=s,console.log(`image宽度:${w.width},image高度:${w.height},截取的left起点${e*r},截取的top起点${t*r}截取的宽度${l*r},截取的高度${s*r}`),v.drawImage(w,e*r,t*r,l*r,s*r,0,0,l,s);var c=d.toDataURL("image/png");return u(c)}}),ge=async e=>new Promise((t,l)=>{const s=document.createElement("canvas"),u=s.getContext("2d");let a=0,d=0;const v=[],r=(w,c)=>{const p=new Image;console.log(w),p.src=w,p.onload=()=>{if(v[c]=p,p.width>a&&(a=p.width),d+=p.height,v.length===e.length){s.width=a,s.height=d;let _=0;v.forEach(j=>{u.drawImage(j,0,_),_+=j.height});const G=s.toDataURL("image/png");t(G)}},p.onerror=()=>{l(new Error("Image loading failed."))}};e.forEach((w,c)=>{r(w,c)})}),ae=(e=200)=>new Promise((t,l)=>{setTimeout(()=>{t("ok")},e)}),ye=async()=>{oe("hide");function e(){chrome.runtime.sendMessage({type:"getBase64"})}let t=parseFloat(o.value.style.top);console.log("距离文档顶部top:",t);let l=parseFloat(o.value.style.height),s=window.innerHeight;console.log("window的height:",s);let a=function(){let c=[];return window.isTopStartScreen=Math.ceil(t/s),c.push(Math.ceil(t/s)),c.push(Math.ceil((t+l)/s)),c}();const d=Math.ceil(document.documentElement.scrollHeight/window.innerHeight);if(console.log(d,"max_captrue"),console.log(a[1],"截取到第几屏幕"),d!==1&&a[1]===d){let p=function(_){return parseInt(_.replace("px",""),10)||0},c=window.innerHeight-(document.documentElement.scrollHeight-window.innerHeight*(d-1));console.log("最后一屏幕缺失了",c+"px");var v=p(document.body.style.paddingBottom)+c;document.body.style.paddingBottom=v+"px",window.lastScreenMissingHeight=v}let r=a[1]-a[0]+1;if(a[0]==a[1]){var w=document.documentElement.style.scrollBehavior;document.documentElement.style.scrollBehavior="auto",window.scrollTo(0,a[0]*window.innerHeight-window.innerHeight),await ae(200),document.documentElement.style.scrollBehavior=w,console.log(`截取第${a[0]}屏幕`),e()}else{let c=a[0];async function p(){if(c<=a[1]){var _=document.documentElement.style.scrollBehavior;document.documentElement.style.scrollBehavior="auto",window.scrollTo(0,c*window.innerHeight-window.innerHeight),document.documentElement.style.scrollBehavior=_;let G=y.length||0;await ae(800),e();const j=setInterval(()=>{G!==y.length&&(c++,clearInterval(j),p())},100)}}await p()}return new Promise((c,p)=>{const _=setInterval(async()=>{if(r==y.length)return clearInterval(_),console.log("凑齐了 开始拼接"),oe("show"),console.log(y),b=await ge(y),window.lastScreenMissingHeight&&(document.body.style.paddingBottom="0px",window.lastScreenMissingHeight=void 0),c(b)},100)})};return(e,t)=>(Z(),ee(be,null,[Ee,te(K)?(Z(),ee("div",Ye,[i("div",{onMouseup:ue,onMousedown:re,onMousemove:ce,id:"awesome_screenshot_wrapper",ref_key:"awesome_screenshot_wrapper",ref:g,style:{display:"block"}},[i("div",{id:"awesome_screenshot_top",ref_key:"awesome_screenshot_top",ref:z},null,512),i("div",{id:"awesome_screenshot_right",ref_key:"awesome_screenshot_right",ref:W},null,512),i("div",{id:"awesome_screenshot_bottom",ref_key:"awesome_screenshot_bottom",ref:Y},null,512),i("div",{id:"awesome_screenshot_left",ref_key:"awesome_screenshot_left",ref:B},null,512),i("div",{id:"awesome_screenshot_center",onMouseup:we,onMousedown:ve,onMousemove:pe,ref_key:"awesome_screenshot_center",ref:o,class:"drsElement drsMoveHandle"},[i("div",Se,[i("span",null,se(te(V))+" X "+se(te(q)),1)]),i("div",{class:"dragresize dragresize-tl",onMousedown:t[0]||(t[0]=l=>f("tl",l))},null,32),i("div",{class:"dragresize dragresize-tm",onMousedown:t[1]||(t[1]=l=>f("tm",l))},null,32),i("div",{class:"dragresize dragresize-tr",onMousedown:t[2]||(t[2]=l=>f("tr",l))},null,32),i("div",{class:"dragresize dragresize-ml",onMousedown:t[3]||(t[3]=l=>f("ml",l))},null,32),i("div",{class:"dragresize dragresize-mr",onMousedown:t[4]||(t[4]=l=>f("mr",l))},null,32),i("div",{class:"dragresize dragresize-bl",onMousedown:t[5]||(t[5]=l=>f("bl",l))},null,32),i("div",{class:"dragresize dragresize-bm",onMousedown:t[6]||(t[6]=l=>f("bm",l))},null,32),i("div",{class:"dragresize dragresize-br",onMousedown:t[7]||(t[7]=l=>f("br",l))},null,32)],544)],544),i("div",ke,[He,i("div",Ie,[i("a",{onClick:J,id:"clear112"},[(Z(),ee("svg",Xe,De))]),i("a",{onClick:he,class:"awesome_action_btn copy"},"Search")]),Le])])):_e("",!0)],64))}},Be=fe(ze,[["__scopeId","data-v-dea953c4"]]),le=document.createElement("div");le.id="screenshot_html";document.body.appendChild(le);console.log("截图插件已经加载");console.log(le,"div");const We=Fe(Be);We.mount("#screenshot_html");
